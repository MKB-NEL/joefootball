<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joe Football Club - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        .sidebar {
            transition: all 0.3s ease;
        }
        .sidebar.collapsed {
            width: 80px;
        }
        .sidebar.collapsed .sidebar-text {
            display: none;
        }
        .sidebar.collapsed .sidebar-icon {
            margin-right: 0;
        }
        .content {
            transition: all 0.3s ease;
        }
        .content.expanded {
            margin-left: 80px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .dropzone {
            border: 2px dashed #cbd5e0;
            transition: all 0.3s ease;
        }
        .dropzone.active {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }
        .preview-image {
            transition: all 0.3s ease;
        }
        .preview-image:hover {
            transform: scale(1.05);
        }
        .spinner {
            display: none;
        }
        .loading .spinner {
            display: inline-block;
        }
    </style>
</head>
<body class="font-sans bg-gray-100">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-blue-900 text-white h-full fixed inset-y-0 left-0 w-64 z-50 shadow-lg">
            <div class="flex items-center justify-between p-4 border-b border-blue-800">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                        <span class="text-blue-800 font-bold text-xl">JFC</span>
                    </div>
                    <span class="text-xl font-bold sidebar-text">JFC ADMIN</span>
                </div>
                <button id="toggle-sidebar" class="text-white focus:outline-none">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <nav class="p-4">
                <ul class="space-y-2">
                    <li>
                        <button onclick="showTab('dashboard')" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left tab-button active">
                            <i class="fas fa-tachometer-alt sidebar-icon mr-3"></i>
                            <span class="sidebar-text">Dashboard</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showTab('players')" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left tab-button">
                            <i class="fas fa-users sidebar-icon mr-3"></i>
                            <span class="sidebar-text">Players</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showTab('matches')" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left tab-button">
                            <i class="fas fa-calendar-alt sidebar-icon mr-3"></i>
                            <span class="sidebar-text">Matches</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showTab('news')" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left tab-button">
                            <i class="fas fa-newspaper sidebar-icon mr-3"></i>
                            <span class="sidebar-text">News</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showTab('gallery')" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left tab-button">
                            <i class="fas fa-images sidebar-icon mr-3"></i>
                            <span class="sidebar-text">Gallery</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showTab('coach')" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left tab-button">
                            <i class="fas fa-user-tie sidebar-icon mr-3"></i>
                            <span class="sidebar-text">Coach</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showTab('sponsors')" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left tab-button">
                            <i class="fas fa-handshake sidebar-icon mr-3"></i>
                            <span class="sidebar-text">Sponsors</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showTab('settings')" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left tab-button">
                            <i class="fas fa-cog sidebar-icon mr-3"></i>
                            <span class="sidebar-text">Settings</span>
                        </button>
                    </li>
                </ul>
            </nav>
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-blue-800">
                <button onclick="logout()" class="w-full flex items-center p-3 rounded-lg hover:bg-blue-800 transition duration-300 text-left">
                    <i class="fas fa-sign-out-alt sidebar-icon mr-3"></i>
                    <span class="sidebar-text">Logout</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="content" class="content flex-1 overflow-auto ml-64">
            <header class="bg-white shadow-sm">
                <div class="flex justify-between items-center p-4">
                    <h1 id="page-title" class="text-2xl font-bold text-blue-900">Dashboard</h1>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button id="user-menu-button" class="flex items-center space-x-2 focus:outline-none">
                                <span class="text-gray-700">Admin</span>
                                <div class="w-8 h-8 bg-blue-700 rounded-full flex items-center justify-center text-white">
                                    <i class="fas fa-user"></i>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <main class="p-6">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500">Total Players</p>
                                    <h3 class="text-3xl font-bold" id="total-players">0</h3>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-users text-blue-700 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500">Upcoming Matches</p>
                                    <h3 class="text-3xl font-bold" id="upcoming-matches">0</h3>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-calendar-alt text-blue-700 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500">Gallery Items</p>
                                    <h3 class="text-3xl font-bold" id="gallery-items">0</h3>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-images text-blue-700 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500">News Articles</p>
                                    <h3 class="text-3xl font-bold" id="news-articles">0</h3>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-newspaper text-blue-700 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-bold mb-4 text-blue-900">Recent Activity</h2>
                        <div class="space-y-4" id="recent-activity">
                            <div class="flex items-center justify-center py-8">
                                <p class="text-gray-500">Loading activity...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Players Tab -->
                <div id="players" class="tab-content">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-xl font-bold text-blue-900">Manage Players</h2>
                        </div>
                        <div class="p-4">
                            <button onclick="openPlayerModal()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium mb-4">
                                <i class="fas fa-plus mr-2"></i> Add New Player
                            </button>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white">
                                    <thead>
                                        <tr class="bg-gray-100 text-gray-700">
                                            <th class="py-3 px-6 text-left">#</th>
                                            <th class="py-3 px-6 text-left">Name</th>
                                            <th class="py-3 px-6 text-left">Position</th>
                                            <th class="py-3 px-6 text-left">Nationality</th>
                                            <th class="py-3 px-6 text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="players-table" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="5" class="py-4 px-6 text-center text-gray-500">Loading players...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Matches Tab -->
                <div id="matches" class="tab-content">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-xl font-bold text-blue-900">Manage Matches</h2>
                        </div>
                        <div class="p-4">
                            <button onclick="openMatchModal()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium mb-4">
                                <i class="fas fa-plus mr-2"></i> Add New Match
                            </button>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white">
                                    <thead>
                                        <tr class="bg-gray-100 text-gray-700">
                                            <th class="py-3 px-6 text-left">Date</th>
                                            <th class="py-3 px-6 text-left">Opponent</th>
                                            <th class="py-3 px-6 text-left">Location</th>
                                            <th class="py-3 px-6 text-left">Time</th>
                                            <th class="py-3 px-6 text-left">Result</th>
                                            <th class="py-3 px-6 text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="matches-table" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="6" class="py-4 px-6 text-center text-gray-500">Loading matches...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- News Tab -->
                <div id="news" class="tab-content">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-xl font-bold text-blue-900">Manage News</h2>
                        </div>
                        <div class="p-4">
                            <button onclick="openNewsModal()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium mb-4">
                                <i class="fas fa-plus mr-2"></i> Add News Article
                            </button>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="news-container">
                                <div class="skeleton h-96 rounded-lg"></div>
                                <div class="skeleton h-96 rounded-lg"></div>
                                <div class="skeleton h-96 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gallery Tab -->
                <div id="gallery" class="tab-content">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-xl font-bold text-blue-900">Manage Gallery</h2>
                        </div>
                        <div class="p-4">
                            <div class="mb-6">
                                <div id="dropzone" class="dropzone border-2 border-dashed rounded-lg p-8 text-center cursor-pointer">
                                    <div class="flex flex-col items-center justify-center">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-600 mb-1">Drag & drop images here or click to browse</p>
                                        <p class="text-xs text-gray-500">Supports JPG, PNG (Max 5MB each)</p>
                                    </div>
                                    <input type="file" id="gallery-upload" class="hidden" accept="image/*" multiple>
                                </div>
                                <div id="upload-progress" class="mt-4 hidden">
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm font-medium text-gray-700">Uploading...</span>
                                        <span class="text-sm font-medium text-gray-700" id="upload-count">0/0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div id="upload-progress-bar" class="bg-blue-700 h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div id="uploaded-images" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-6"></div>
                                <div id="save-button-container" class="mt-4 hidden">
                                    <button onclick="saveGalleryImages()" class="bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 rounded-md font-medium">
                                        SAVE IMAGES TO GALLERY
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="gallery-container">
                                <div class="skeleton h-64 rounded-lg"></div>
                                <div class="skeleton h-64 rounded-lg"></div>
                                <div class="skeleton h-64 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coach Tab -->
                <div id="coach" class="tab-content">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-xl font-bold text-blue-900">Manage Coach</h2>
                        </div>
                        <div class="p-4">
                            <form id="coach-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div class="md:col-span-2">
                                        <div class="space-y-6">
                                            <div>
                                                <label for="coach-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                                <input type="text" id="coach-name" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                            </div>
                                            <div>
                                                <label for="coach-speech" class="block text-sm font-medium text-gray-700 mb-1">Speech</label>
                                                <textarea id="coach-speech" rows="4" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Badges</label>
                                                <div id="badges-container" class="flex flex-wrap gap-2 mb-2">
                                                    <!-- Badges will be added here -->
                                                </div>
                                                <div class="flex">
                                                    <input type="text" id="new-badge" placeholder="Add a new badge" class="flex-grow px-4 py-2 rounded-l-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                    <button type="button" onclick="addBadge()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-r-md">
                                                        Add
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="coach-image" class="block text-sm font-medium text-gray-700 mb-1">Photo</label>
                                        <div class="relative">
                                            <img id="coach-image-preview" src="https://via.placeholder.com/300x400?text=Coach" alt="Coach" class="w-full h-64 object-cover rounded-lg border border-gray-300">
                                            <input type="file" id="coach-image" class="hidden" accept="image/*">
                                            <button type="button" onclick="document.getElementById('coach-image').click()" class="absolute bottom-2 right-2 bg-blue-700 hover:bg-blue-800 text-white p-2 rounded-full">
                                                <i class="fas fa-camera"></i>
                                            </button>
                                        </div>
                                        <div class="mt-2">
                                            <button type="button" onclick="uploadCoachImage()" class="w-full bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium">
                                                Upload Image
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 rounded-md font-medium">
                                        Save Coach Information
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Sponsors Tab -->
                <div id="sponsors" class="tab-content">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-xl font-bold text-blue-900">Manage Sponsors</h2>
                        </div>
                        <div class="p-4">
                            <button onclick="openSponsorModal()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium mb-4">
                                <i class="fas fa-plus mr-2"></i> Add New Sponsor
                            </button>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="sponsors-container">
                                <div class="skeleton h-32 rounded-lg"></div>
                                <div class="skeleton h-32 rounded-lg"></div>
                                <div class="skeleton h-32 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settings" class="tab-content">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-xl font-bold text-blue-900">Club Settings</h2>
                        </div>
                        <div class="p-4">
                            <form id="settings-form" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Next Match</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label for="next-match-home" class="block text-sm font-medium text-gray-700 mb-1">Home Team</label>
                                            <input type="text" id="next-match-home" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label for="next-match-away" class="block text-sm font-medium text-gray-700 mb-1">Away Team</label>
                                            <input type="text" id="next-match-away" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label for="next-match-date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                            <input type="date" id="next-match-date" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label for="next-match-time" class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                                            <input type="time" id="next-match-time" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label for="next-match-competition" class="block text-sm font-medium text-gray-700 mb-1">Competition</label>
                                            <input type="text" id="next-match-competition" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Club Stats</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                        <div>
                                            <label for="stats-matches" class="block text-sm font-medium text-gray-700 mb-1">Matches Played</label>
                                            <input type="number" id="stats-matches" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label for="stats-wins" class="block text-sm font-medium text-gray-700 mb-1">Wins</label>
                                            <input type="number" id="stats-wins" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label for="stats-goals" class="block text-sm font-medium text-gray-700 mb-1">Goals Scored</label>
                                            <input type="number" id="stats-goals" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                        <div>
                                            <label for="stats-points" class="block text-sm font-medium text-gray-700 mb-1">Points</label>
                                            <input type="number" id="stats-points" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Footer Text</label>
                                    <textarea id="footer-text" rows="3" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Social Links</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label for="social-facebook" class="block text-sm font-medium text-gray-700 mb-1">Facebook</label>
                                            <input type="url" id="social-facebook" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label for="social-twitter" class="block text-sm font-medium text-gray-700 mb-1">Twitter</label>
                                            <input type="url" id="social-twitter" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label for="social-instagram" class="block text-sm font-medium text-gray-700 mb-1">Instagram</label>
                                            <input type="url" id="social-instagram" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label for="social-youtube" class="block text-sm font-medium text-gray-700 mb-1">YouTube</label>
                                            <input type="url" id="social-youtube" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label for="social-tiktok" class="block text-sm font-medium text-gray-700 mb-1">TikTok</label>
                                            <input type="url" id="social-tiktok" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 rounded-md font-medium">
                                        Save Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Player Modal -->
    <div id="player-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-blue-900" id="player-modal-title">Add New Player</h3>
                <button onclick="closeModal('player-modal')" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="player-form" class="p-6 space-y-6">
                <input type="hidden" id="player-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="player-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="player-name" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="player-number" class="block text-sm font-medium text-gray-700 mb-1">Jersey Number</label>
                        <input type="number" id="player-number" min="0" max="99" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="player-position" class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                        <select id="player-position" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Select Position</option>
                            <option value="Goalkeeper">Goalkeeper</option>
                            <option value="Defender">Defender</option>
                            <option value="Midfielder">Midfielder</option>
                            <option value="Forward">Forward</option>
                        </select>
                    </div>
                    <div>
                        <label for="player-nationality" class="block text-sm font-medium text-gray-700 mb-1">Nationality</label>
                        <input type="text" id="player-nationality" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="player-role" class="block text-sm font-medium text-gray-700 mb-1">Role (optional)</label>
                        <input type="text" id="player-role" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="player-image" class="block text-sm font-medium text-gray-700 mb-1">Player Photo</label>
                        <div class="relative">
                            <img id="player-image-preview" src="https://via.placeholder.com/300x400?text=Player" alt="Player" class="w-full h-48 object-cover rounded-lg border border-gray-300">
                            <input type="file" id="player-image" class="hidden" accept="image/*">
                            <button type="button" onclick="document.getElementById('player-image').click()" class="absolute bottom-2 right-2 bg-blue-700 hover:bg-blue-800 text-white p-2 rounded-full">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <div class="mt-2">
                            <button type="button" onclick="uploadPlayerImage()" class="w-full bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium">
                                Upload Image
                            </button>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeModal('player-modal')" class="px-6 py-2 border border-gray-300 rounded-md font-medium text-gray-700 hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 rounded-md font-medium">
                        Save Player
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Match Modal -->
    <div id="match-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-blue-900" id="match-modal-title">Add New Match</h3>
                <button onclick="closeModal('match-modal')" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="match-form" class="p-6 space-y-6">
                <input type="hidden" id="match-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="match-date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="match-date" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="match-time" class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                        <input type="time" id="match-time" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="match-home" class="block text-sm font-medium text-gray-700 mb-1">Home Team</label>
                        <input type="text" id="match-home" value="Joe FC" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="match-away" class="block text-sm font-medium text-gray-700 mb-1">Away Team</label>
                                                <input type="text" id="match-away" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="match-location" class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                        <input type="text" id="match-location" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="match-competition" class="block text-sm font-medium text-gray-700 mb-1">Competition</label>
                        <input type="text" id="match-competition" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="match-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select id="match-status" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="Upcoming">Upcoming</option>
                            <option value="Live">Live</option>
                            <option value="Finished">Finished</option>
                            <option value="Postponed">Postponed</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div id="result-fields" class="hidden">
                        <label for="match-result" class="block text-sm font-medium text-gray-700 mb-1">Result</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="match-home-score" min="0" class="w-16 px-3 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <span>:</span>
                            <input type="number" id="match-away-score" min="0" class="w-16 px-3 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>
                <div>
                    <label for="match-description" class="block text-sm font-medium text-gray-700 mb-1">Match Description (optional)</label>
                    <textarea id="match-description" rows="3" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeModal('match-modal')" class="px-6 py-2 border border-gray-300 rounded-md font-medium text-gray-700 hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 rounded-md font-medium">
                        Save Match
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- News Modal -->
    <div id="news-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-blue-900" id="news-modal-title">Add News Article</h3>
                <button onclick="closeModal('news-modal')" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="news-form" class="p-6 space-y-6">
                <input type="hidden" id="news-id">
                <div>
                    <label for="news-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                    <input type="text" id="news-title" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="news-category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                        <select id="news-category" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Select Category</option>
                            <option value="Match Report">Match Report</option>
                            <option value="Team News">Team News</option>
                            <option value="Transfer News">Transfer News</option>
                            <option value="Club Announcement">Club Announcement</option>
                            <option value="Community">Community</option>
                        </select>
                    </div>
                    <div>
                        <label for="news-date" class="block text-sm font-medium text-gray-700 mb-1">Publish Date</label>
                        <input type="date" id="news-date" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                </div>
                <div>
                    <label for="news-image" class="block text-sm font-medium text-gray-700 mb-1">Featured Image</label>
                    <div class="relative">
                        <img id="news-image-preview" src="https://via.placeholder.com/800x450?text=News" alt="News" class="w-full h-48 object-cover rounded-lg border border-gray-300">
                        <input type="file" id="news-image" class="hidden" accept="image/*">
                        <button type="button" onclick="document.getElementById('news-image').click()" class="absolute bottom-2 right-2 bg-blue-700 hover:bg-blue-800 text-white p-2 rounded-full">
                            <i class="fas fa-camera"></i>
                        </button>
                    </div>
                    <div class="mt-2">
                        <button type="button" onclick="uploadNewsImage()" class="w-full bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium">
                            Upload Image
                        </button>
                    </div>
                </div>
                <div>
                    <label for="news-content" class="block text-sm font-medium text-gray-700 mb-1">Content</label>
                    <textarea id="news-content" rows="10" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required></textarea>
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeModal('news-modal')" class="px-6 py-2 border border-gray-300 rounded-md font-medium text-gray-700 hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 rounded-md font-medium">
                        Publish News
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sponsor Modal -->
    <div id="sponsor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-blue-900" id="sponsor-modal-title">Add New Sponsor</h3>
                <button onclick="closeModal('sponsor-modal')" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="sponsor-form" class="p-6 space-y-6">
                <input type="hidden" id="sponsor-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="sponsor-name" class="block text-sm font-medium text-gray-700 mb-1">Sponsor Name</label>
                        <input type="text" id="sponsor-name" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label for="sponsor-type" class="block text-sm font-medium text-gray-700 mb-1">Sponsorship Type</label>
                        <select id="sponsor-type" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Select Type</option>
                            <option value="Main Sponsor">Main Sponsor</option>
                            <option value="Official Partner">Official Partner</option>
                            <option value="Kit Sponsor">Kit Sponsor</option>
                            <option value="Media Partner">Media Partner</option>
                            <option value="Community Partner">Community Partner</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="sponsor-website" class="block text-sm font-medium text-gray-700 mb-1">Website URL</label>
                    <input type="url" id="sponsor-website" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label for="sponsor-logo" class="block text-sm font-medium text-gray-700 mb-1">Logo</label>
                    <div class="relative">
                        <img id="sponsor-logo-preview" src="https://via.placeholder.com/300x150?text=Sponsor+Logo" alt="Sponsor Logo" class="w-full h-32 object-contain rounded-lg border border-gray-300">
                        <input type="file" id="sponsor-logo" class="hidden" accept="image/*">
                        <button type="button" onclick="document.getElementById('sponsor-logo').click()" class="absolute bottom-2 right-2 bg-blue-700 hover:bg-blue-800 text-white p-2 rounded-full">
                            <i class="fas fa-camera"></i>
                        </button>
                    </div>
                    <div class="mt-2">
                        <button type="button" onclick="uploadSponsorLogo()" class="w-full bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md font-medium">
                            Upload Logo
                        </button>
                    </div>
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeModal('sponsor-modal')" class="px-6 py-2 border border-gray-300 rounded-md font-medium text-gray-700 hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 rounded-md font-medium">
                        Save Sponsor
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-blue-900">Confirm Action</h3>
                    <button onclick="closeModal('confirm-modal')" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <p id="confirm-message" class="text-gray-700 mb-6">Are you sure you want to perform this action?</p>
                <div class="flex justify-end space-x-4">
                    <button onclick="closeModal('confirm-modal')" class="px-6 py-2 border border-gray-300 rounded-md font-medium text-gray-700 hover:bg-gray-100">
                        Cancel
                    </button>
                    <button id="confirm-action" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md font-medium">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getFirestore, collection, doc, getDoc, getDocs, addDoc, updateDoc, deleteDoc, query, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-storage.js";
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";

    // Create global namespace to prevent conflicts
    window.JoeFC = window.JoeFC || {};

    // Firebase configuration and initialization
    JoeFC.firebase = (() => {
        const firebaseConfig = {
            apiKey: "AIzaSyBBSNRSIEooqL1FZe-MQTzx2AntRvfJ85o",
            authDomain: "joefootball-15e7a.firebaseapp.com",
            databaseURL: "https://joefootball-15e7a-default-rtdb.firebaseio.com",
            projectId: "joefootball-15e7a",
            storageBucket: "joefootball-15e7a.firebasestorage.app",
            messagingSenderId: "976347287101",
            appId: "1:976347287101:web:b13786927105f963986454",
            measurementId: "G-9ZD2Y7CK35"
        };
        const app = initializeApp(firebaseConfig);
        return {
            db: getFirestore(app),
            storage: getStorage(app),
            auth: getAuth(app)
        };
    })();

    // UI-related functions
    JoeFC.ui = {
        toggleSidebar: () => {
            const sidebar = document.getElementById('sidebar');
            const content = document.getElementById('content');
            sidebar.classList.toggle('collapsed');
            content.classList.toggle('expanded');
        },

        showTab: (tabId) => {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.querySelector(`.tab-button[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById('page-title').textContent = document.querySelector(`.tab-button[data-tab="${tabId}"] .sidebar-text`).textContent;

            const loadFunctions = {
                dashboard: JoeFC.data.loadDashboard,
                players: JoeFC.data.loadPlayers,
                matches: JoeFC.data.loadMatches,
                news: JoeFC.data.loadNews,
                gallery: JoeFC.data.loadGallery,
                coach: JoeFC.data.loadCoach,
                sponsors: JoeFC.data.loadSponsors,
                settings: JoeFC.data.loadSettings
            };
            if (loadFunctions[tabId]) loadFunctions[tabId]();
        },

        openPlayerModal: (playerId = null) => {
            const modalTitle = document.getElementById('player-modal-title');
            const form = document.getElementById('player-form');
            const imagePreview = document.getElementById('player-image-preview');
            if (playerId) {
                modalTitle.textContent = 'Edit Player';
                document.getElementById('player-id').value = playerId;
                getDoc(doc(JoeFC.firebase.db, 'players', playerId)).then(doc => {
                    if (doc.exists()) {
                        const data = doc.data();
                        document.getElementById('player-name').value = data.name || '';
                        document.getElementById('player-number').value = data.number || '';
                        document.getElementById('player-position').value = data.position || '';
                        document.getElementById('player-nationality').value = data.nationality || '';
                        document.getElementById('player-role').value = data.role || '';
                        imagePreview.src = data.image || 'https://via.placeholder.com/300x400?text=Player';
                    }
                }).catch(e => console.error('Error loading player:', e));
            } else {
                modalTitle.textContent = 'Add New Player';
                document.getElementById('player-id').value = '';
                form.reset();
                imagePreview.src = 'https://via.placeholder.com/300x400?text=Player';
            }
            document.getElementById('player-modal').classList.remove('hidden');
        },

        openMatchModal: (matchId = null) => {
            const modalTitle = document.getElementById('match-modal-title');
            const form = document.getElementById('match-form');
            if (matchId) {
                modalTitle.textContent = 'Edit Match';
                document.getElementById('match-id').value = matchId;
                getDoc(doc(JoeFC.firebase.db, 'matches', matchId)).then(doc => {
                    if (doc.exists()) {
                        const data = doc.data();
                        document.getElementById('match-date').value = data.date || '';
                        document.getElementById('match-time').value = data.time || '';
                        document.getElementById('match-home').value = data.homeTeam || 'Joe FC';
                        document.getElementById('match-away').value = data.awayTeam || '';
                        document.getElementById('match-location').value = data.location || '';
                        document.getElementById('match-competition').value = data.competition || '';
                        document.getElementById('match-status').value = data.status || 'Upcoming';
                        document.getElementById('match-description').value = data.description || '';
                        document.getElementById('result-fields').classList.toggle('hidden', data.status !== 'Finished');
                        if (data.status === 'Finished') {
                            document.getElementById('match-home-score').value = data.result?.homeScore || 0;
                            document.getElementById('match-away-score').value = data.result?.awayScore || 0;
                        }
                    }
                }).catch(e => console.error('Error loading match:', e));
            } else {
                modalTitle.textContent = 'Add New Match';
                document.getElementById('match-id').value = '';
                form.reset();
                document.getElementById('match-home').value = 'Joe FC';
                document.getElementById('result-fields').classList.add('hidden');
            }
            document.getElementById('match-modal').classList.remove('hidden');
        },

        openNewsModal: (newsId = null) => {
            const modalTitle = document.getElementById('news-modal-title');
            const form = document.getElementById('news-form');
            const imagePreview = document.getElementById('news-image-preview');
            if (newsId) {
                modalTitle.textContent = 'Edit News Article';
                document.getElementById('news-id').value = newsId;
                getDoc(doc(JoeFC.firebase.db, 'news', newsId)).then(doc => {
                    if (doc.exists()) {
                        const data = doc.data();
                        document.getElementById('news-title').value = data.title || '';
                        document.getElementById('news-category').value = data.category || '';
                        document.getElementById('news-date').value = data.date || '';
                        document.getElementById('news-content').value = data.content || '';
                        imagePreview.src = data.image || 'https://via.placeholder.com/800x450?text=News';
                    }
                }).catch(e => console.error('Error loading news:', e));
            } else {
                modalTitle.textContent = 'Add News Article';
                document.getElementById('news-id').value = '';
                form.reset();
                imagePreview.src = 'https://via.placeholder.com/800x450?text=News';
            }
            document.getElementById('news-modal').classList.remove('hidden');
        },

        openSponsorModal: (sponsorId = null) => {
            const modalTitle = document.getElementById('sponsor-modal-title');
            const form = document.getElementById('sponsor-form');
            const imagePreview = document.getElementById('sponsor-logo-preview');
            if (sponsorId) {
                modalTitle.textContent = 'Edit Sponsor';
                document.getElementById('sponsor-id').value = sponsorId;
                getDoc(doc(JoeFC.firebase.db, 'sponsors', sponsorId)).then(doc => {
                    if (doc.exists()) {
                        const data = doc.data();
                        document.getElementById('sponsor-name').value = data.name || '';
                        document.getElementById('sponsor-type').value = data.type || '';
                        document.getElementById('sponsor-website').value = data.website || '';
                        imagePreview.src = data.image || 'https://via.placeholder.com/300x150?text=Sponsor+Logo';
                    }
                }).catch(e => console.error('Error loading sponsor:', e));
            } else {
                modalTitle.textContent = 'Add New Sponsor';
                document.getElementById('sponsor-id').value = '';
                form.reset();
                imagePreview.src = 'https://via.placeholder.com/300x150?text=Sponsor+Logo';
            }
            document.getElementById('sponsor-modal').classList.remove('hidden');
        },

        closeModal: (modalId) => {
            document.getElementById(modalId).classList.add('hidden');
        },

        showConfirmModal: (message, callback) => {
            document.getElementById('confirm-message').textContent = message;
            document.getElementById('confirm-modal').classList.remove('hidden');
            const confirmButton = document.getElementById('confirm-action');
            confirmButton.replaceWith(confirmButton.cloneNode(true));
            document.getElementById('confirm-action').addEventListener('click', () => {
                callback();
                JoeFC.ui.closeModal('confirm-modal');
            });
        },

        addBadge: () => {
            const badgeInput = document.getElementById('new-badge');
            const badgeText = badgeInput.value.trim();
            if (badgeText) {
                const badge = document.createElement('div');
                badge.className = 'flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm';
                badge.innerHTML = `
                    ${badgeText}
                    <button class="remove-badge-btn ml-2 text-blue-600 hover:text-blue-800">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                document.getElementById('badges-container').appendChild(badge);
                badgeInput.value = '';
            }
        }
    };

    // Image upload functions
    JoeFC.image = {
        uploadImage: async (file, path) => {
            if (!file) return null;
            const storageRef = ref(JoeFC.firebase.storage, path);
            await uploadBytes(storageRef, file);
            return await getDownloadURL(storageRef);
        },

        previewPlayerImage: () => {
            JoeFC.image.previewImage('player-image', 'player-image-preview');
        },

        previewCoachImage: () => {
            JoeFC.image.previewImage('coach-image', 'coach-image-preview');
        },

        previewNewsImage: () => {
            JoeFC.image.previewImage('news-image', 'news-image-preview');
        },

        previewSponsorLogo: () => {
            JoeFC.image.previewImage('sponsor-logo', 'sponsor-logo-preview', true);
        },

        previewImage: (fileInputId, previewId, isLogo = false) => {
            const fileInput = document.getElementById(fileInputId);
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById(previewId);
                    preview.src = e.target.result;
                    if (isLogo) {
                        preview.classList.add('object-contain');
                        preview.classList.remove('object-cover');
                    }
                };
                reader.readAsDataURL(fileInput.files[0]);
            }
        }
    };

    // Data-related functions
    JoeFC.data = {
        loadDashboard: async () => {
            try {
                const [playersSnap, matchesSnap, gallerySnap, newsSnap, activitySnap] = await Promise.all([
                    getDocs(collection(JoeFC.firebase.db, 'players')),
                    getDocs(collection(JoeFC.firebase.db, 'matches')),
                    getDocs(collection(JoeFC.firebase.db, 'gallery')),
                    getDocs(collection(JoeFC.firebase.db, 'news')),
                    getDocs(query(collection(JoeFC.firebase.db, 'activities'), orderBy('timestamp', 'desc')))
                ]);
                document.getElementById('total-players').textContent = playersSnap.size;
                document.getElementById('upcoming-matches').textContent = matchesSnap.docs.filter(doc => doc.data().status === 'Upcoming').length;
                document.getElementById('gallery-items').textContent = gallerySnap.size;
                document.getElementById('news-articles').textContent = newsSnap.size;

                const activityList = document.getElementById('recent-activity');
                activityList.innerHTML = activitySnap.empty
                    ? '<p class="text-center text-gray-500">No recent activity.</p>'
                    : activitySnap.docs.map(doc => {
                        const activity = doc.data();
                        return `
                            <div class="flex items-start p-3 rounded-lg hover:bg-gray-50">
                                <div class="flex-shrink-0 mt-1">
                                    <div class="h-10 w-10 rounded-full ${activity.color} flex items-center justify-center text-white">
                                        <i class="fas ${activity.icon}"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-900">${activity.text}</p>
                                    <p class="text-xs text-gray-500">${activity.timestamp.toDate().toLocaleString()}</p>
                                </div>
                            </div>
                        `;
                    }).join('');
            } catch (e) {
                console.error('Error loading dashboard:', e);
            }
        },

        loadPlayers: async () => {
            try {
                const playersSnapshot = await getDocs(query(collection(JoeFC.firebase.db, 'players'), orderBy('number')));
                const tableBody = document.getElementById('players-table');
                tableBody.innerHTML = playersSnapshot.empty
                    ? '<tr><td colspan="5" class="py-4 px-6 text-center text-gray-500">No players available.</td></tr>'
                    : playersSnapshot.docs.map((doc, index) => {
                        const player = doc.data();
                        return `
                            <tr>
                                <td class="py-3 px-6">${index + 1}</td>
                                <td class="py-3 px-6">${player.name}</td>
                                <td class="py-3 px-6">${player.position}</td>
                                <td class="py-3 px-6">${player.nationality}</td>
                                <td class="py-3 px-6 text-center">
                                    <button class="edit-player-btn text-blue-600 hover:text-blue-800 mr-2" data-id="${doc.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-player-btn text-red-600 hover:text-red-800" data-id="${doc.id}" data-name="${player.name}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
            } catch (e) {
                console.error('Error loading players:', e);
                document.getElementById('players-table').innerHTML = '<tr><td colspan="5" class="py-4 px-6 text-center text-gray-500">Failed to load players.</td></tr>';
            }
        },

        deletePlayer: (id, name) => {
            JoeFC.ui.showConfirmModal(`Are you sure you want to delete ${name}?`, async () => {
                try {
                    await deleteDoc(doc(JoeFC.firebase.db, 'players', id));
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-user-minus',
                        color: 'bg-red-500',
                        text: `Player deleted: ${name}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Player deleted successfully!');
                    JoeFC.data.loadPlayers();
                    JoeFC.data.loadDashboard();
                } catch (e) {
                    console.error('Error deleting player:', e);
                    alert('Error deleting player.');
                }
            });
        },

        loadMatches: async () => {
            try {
                const matchesSnapshot = await getDocs(query(collection(JoeFC.firebase.db, 'matches'), orderBy('date', 'desc')));
                const tableBody = document.getElementById('matches-table');
                tableBody.innerHTML = matchesSnapshot.empty
                    ? '<tr><td colspan="6" class="py-4 px-6 text-center text-gray-500">No matches available.</td></tr>'
                    : matchesSnapshot.docs.map(doc => {
                        const match = doc.data();
                        const result = match.status === 'Finished' ? `${match.result?.homeScore || 0} - ${match.result?.awayScore || 0}` : '-';
                        return `
                            <tr>
                                <td class="py-3 px-6">${match.date}</td>
                                <td class="py-3 px-6">${match.awayTeam}</td>
                                <td class="py-3 px-6">${match.location}</td>
                                <td class="py-3 px-6">${match.time}</td>
                                <td class="py-3 px-6">${result}</td>
                                <td class="py-3 px-6 text-center">
                                    <button class="edit-match-btn text-blue-600 hover:text-blue-800 mr-2" data-id="${doc.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-match-btn text-red-600 hover:text-red-800" data-id="${doc.id}" data-name="${match.homeTeam} vs ${match.awayTeam}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
            } catch (e) {
                console.error('Error loading matches:', e);
                document.getElementById('matches-table').innerHTML = '<tr><td colspan="6" class="py-4 px-6 text-center text-gray-500">Failed to load matches.</td></tr>';
            }
        },

        deleteMatch: (id, name) => {
            JoeFC.ui.showConfirmModal(`Are you sure you want to delete the match ${name}?`, async () => {
                try {
                    await deleteDoc(doc(JoeFC.firebase.db, 'matches', id));
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-calendar-times',
                        color: 'bg-red-500',
                        text: `Match deleted: ${name}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Match deleted successfully!');
                    JoeFC.data.loadMatches();
                    JoeFC.data.loadDashboard();
                } catch (e) {
                    console.error('Error deleting match:', e);
                    alert('Error deleting match.');
                }
            });
        },

        loadNews: async () => {
            try {
                const newsSnapshot = await getDocs(query(collection(JoeFC.firebase.db, 'news'), orderBy('timestamp', 'desc')));
                const container = document.getElementById('news-container');
                container.innerHTML = newsSnapshot.empty
                    ? '<p class="col-span-full text-center text-gray-600">No news available.</p>'
                    : newsSnapshot.docs.map(doc => {
                        const news = doc.data();
                        const date = news.timestamp?.toDate().toLocaleDateString() || 'N/A';
                        const categoryColor = {
                            'Match Report': 'bg-blue-700',
                            'Team News': 'bg-green-600',
                            'Transfer News': 'bg-red-600',
                            'Club Announcement': 'bg-purple-600',
                            'Community': 'bg-yellow-500'
                        }[news.category] || 'bg-gray-500';
                        return `
                            <div class="bg-white rounded-lg overflow-hidden shadow-md news-card transition duration-300">
                                <div class="relative overflow-hidden h-48">
                                    <img src="${news.image || 'https://via.placeholder.com/600x400?text=News'}" alt="${news.title}" class="w-full h-full object-cover">
                                    <div class="absolute top-4 left-4 ${categoryColor} text-white px-3 py-1 rounded-md text-sm font-bold">
                                        ${news.category || 'General'}
                                    </div>
                                </div>
                                <div class="p-4">
                                    <div class="text-xs text-gray-500 mb-2">${date}</div>
                                    <h3 class="text-lg font-bold mb-2">${news.title}</h3>
                                    <p class="text-gray-600 text-sm">${news.content.substring(0, 100)}...</p>
                                    <div class="mt-4 flex justify-end space-x-2">
                                        <button class="edit-news-btn text-blue-600 hover:text-blue-800" data-id="${doc.id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="delete-news-btn text-red-600 hover:text-red-800" data-id="${doc.id}" data-title="${news.title}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
            } catch (e) {
                console.error('Error loading news:', e);
                document.getElementById('news-container').innerHTML = '<p class="col-span-full text-center text-gray-600">Failed to load news.</p>';
            }
        },

        deleteNews: (id, title) => {
            JoeFC.ui.showConfirmModal(`Are you sure you want to delete the news article "${title}"?`, async () => {
                try {
                    await deleteDoc(doc(JoeFC.firebase.db, 'news', id));
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-newspaper',
                        color: 'bg-red-500',
                        text: `News article deleted: ${title}`,
                        timestamp: Timestamp.now()
                    });
                    alert('News article deleted successfully!');
                    JoeFC.data.loadNews();
                    JoeFC.data.loadDashboard();
                } catch (e) {
                    console.error('Error deleting news:', e);
                    alert('Error deleting news article.');
                }
            });
        },

        loadGallery: async () => {
            try {
                const gallerySnapshot = await getDocs(query(collection(JoeFC.firebase.db, 'gallery'), orderBy('timestamp', 'desc')));
                const container = document.getElementById('gallery-container');
                container.innerHTML = gallerySnapshot.empty
                    ? '<p class="col-span-full text-center text-gray-600">No gallery images available.</p>'
                    : gallerySnapshot.docs.map(doc => {
                        const item = doc.data();
                        return `
                            <div class="relative group overflow-hidden rounded-lg h-64">
                                <img src="${item.image || 'https://via.placeholder.com/800x600?text=Gallery'}" alt="${item.description}" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                                <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300">
                                    <span class="text-white font-bold text-lg text-center px-4">${item.description}</span>
                                </div>
                                <button class="delete-gallery-btn absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity" data-id="${doc.id}" data-description="${item.description}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                    }).join('');
            } catch (e) {
                console.error('Error loading gallery:', e);
                document.getElementById('gallery-container').innerHTML = '<p class="col-span-full text-center text-gray-600">Failed to load gallery.</p>';
            }
        },

        deleteGalleryImage: (id, description) => {
            JoeFC.ui.showConfirmModal(`Are you sure you want to delete the image "${description}"?`, async () => {
                try {
                    await deleteDoc(doc(JoeFC.firebase.db, 'gallery', id));
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-image',
                        color: 'bg-red-500',
                        text: `Gallery image deleted: ${description}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Gallery image deleted successfully!');
                    JoeFC.data.loadGallery();
                    JoeFC.data.loadDashboard();
                } catch (e) {
                    console.error('Error deleting gallery image:', e);
                    alert('Error deleting gallery image.');
                }
            });
        },

        loadCoach: async () => {
            try {
                const coachDoc = await getDoc(doc(JoeFC.firebase.db, 'settings', 'coach'));
                const coachName = document.getElementById('coach-name');
                const coachImage = document.getElementById('coach-image-preview');
                const coachSpeech = document.getElementById('coach-speech');
                const coachBadges = document.getElementById('badges-container');
                if (coachDoc.exists()) {
                    const data = coachDoc.data();
                    coachName.value = data.name || '';
                    coachSpeech.value = data.speech || '';
                    coachImage.src = data.image || 'https://via.placeholder.com/300x400?text=Coach';
                    coachBadges.innerHTML = data.badges && Array.isArray(data.badges)
                        ? data.badges.map(badge => `
                            <div class="flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                ${badge}
                                <button class="remove-badge-btn ml-2 text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `).join('')
                        : '';
                } else {
                    coachName.value = '';
                    coachSpeech.value = '';
                    coachImage.src = 'https://via.placeholder.com/300x400?text=Coach';
                    coachBadges.innerHTML = '';
                }
            } catch (e) {
                console.error('Error loading coach:', e);
            }
        },

        loadSponsors: async () => {
            try {
                const sponsorsSnapshot = await getDocs(query(collection(JoeFC.firebase.db, 'sponsors'), orderBy('timestamp', 'desc')));
                const container = document.getElementById('sponsors-container');
                container.innerHTML = sponsorsSnapshot.empty
                    ? '<p class="col-span-full text-center text-gray-600">No sponsors available.</p>'
                    : sponsorsSnapshot.docs.map(doc => {
                        const sponsor = doc.data();
                        return `
                            <div class="relative group bg-white rounded-lg p-4 shadow-md">
                                <img src="${sponsor.image || 'https://via.placeholder.com/300x150?text=Sponsor+Logo'}" alt="${sponsor.name}" class="w-full h-32 object-contain">
                                <div class="mt-2">
                                    <h4 class="font-bold text-sm">${sponsor.name}</h4>
                                    <p class="text-xs text-gray-600">${sponsor.type}</p>
                                </div>
                                <div class="absolute top-2 right-2 flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button class="edit-sponsor-btn text-blue-600 hover:text-blue-800" data-id="${doc.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-sponsor-btn text-red-600 hover:text-red-800" data-id="${doc.id}" data-name="${sponsor.name}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
            } catch (e) {
                console.error('Error loading sponsors:', e);
                document.getElementById('sponsors-container').innerHTML = '<p class="col-span-full text-center text-gray-600">Failed to load sponsors.</p>';
            }
        },

        deleteSponsor: (id, name) => {
            JoeFC.ui.showConfirmModal(`Are you sure you want to delete the sponsor "${name}"?`, async () => {
                try {
                    await deleteDoc(doc(JoeFC.firebase.db, 'sponsors', id));
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-handshake',
                        color: 'bg-red-500',
                        text: `Sponsor deleted: ${name}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Sponsor deleted successfully!');
                    JoeFC.data.loadSponsors();
                    JoeFC.data.loadDashboard();
                } catch (e) {
                    console.error('Error deleting sponsor:', e);
                    alert('Error deleting sponsor.');
                }
            });
        },

        loadSettings: async () => {
            try {
                const [nextMatchDoc, statsDoc, footerDoc, socialDoc] = await Promise.all([
                    getDoc(doc(JoeFC.firebase.db, 'settings', 'nextMatch')),
                    getDoc(doc(JoeFC.firebase.db, 'settings', 'stats')),
                    getDoc(doc(JoeFC.firebase.db, 'settings', 'footer')),
                    getDoc(doc(JoeFC.firebase.db, 'settings', 'social'))
                ]);
                if (nextMatchDoc.exists()) {
                    const data = nextMatchDoc.data();
                    document.getElementById('next-match-home').value = data.homeTeam || '';
                    document.getElementById('next-match-away').value = data.awayTeam || '';
                    document.getElementById('next-match-date').value = data.date || '';
                    document.getElementById('next-match-time').value = data.time || '';
                    document.getElementById('next-match-competition').value = data.competition || '';
                }
                if (statsDoc.exists()) {
                    const data = statsDoc.data();
                    document.getElementById('stats-matches').value = data.matches || 0;
                    document.getElementById('stats-wins').value = data.wins || 0;
                    document.getElementById('stats-goals').value = data.goals || 0;
                    document.getElementById('stats-points').value = data.points || 0;
                }
                if (footerDoc.exists()) {
                    document.getElementById('footer-text').value = footerDoc.data().text || '';
                }
                if (socialDoc.exists()) {
                    const data = socialDoc.data();
                    document.getElementById('social-facebook').value = data.facebook || '';
                    document.getElementById('social-twitter').value = data.twitter || '';
                    document.getElementById('social-instagram').value = data.instagram || '';
                    document.getElementById('social-youtube').value = data.youtube || '';
                    document.getElementById('social-tiktok').value = data.tiktok || '';
                }
            } catch (e) {
                console.error('Error loading settings:', e);
            }
        }
    };

    // Form submission handlers
    JoeFC.forms = {
        handlePlayerSubmit: async (e) => {
            e.preventDefault();
            const id = document.getElementById('player-id').value;
            const name = document.getElementById('player-name').value.trim();
            const number = document.getElementById('player-number').value;
            const position = document.getElementById('player-position').value;
            const nationality = document.getElementById('player-nationality').value.trim();
            const role = document.getElementById('player-role').value.trim();
            const file = document.getElementById('player-image').files[0];
            try {
                let imageUrl = document.getElementById('player-image-preview').src;
                if (file) {
                    imageUrl = await JoeFC.image.uploadImage(file, `players/${Date.now()}_${file.name}`);
                }
                const playerData = {
                    name,
                    number: parseInt(number),
                    position,
                    nationality,
                    role: role || null,
                    image: imageUrl,
                    timestamp: Timestamp.now()
                };
                if (id) {
                    await updateDoc(doc(JoeFC.firebase.db, 'players', id), playerData);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-user-edit',
                        color: 'bg-blue-500',
                        text: `Player updated: ${name}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Player updated successfully!');
                } else {
                    await addDoc(collection(JoeFC.firebase.db, 'players'), playerData);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-user-plus',
                        color: 'bg-green-500',
                        text: `Player added: ${name}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Player added successfully!');
                }
                JoeFC.ui.closeModal('player-modal');
                JoeFC.data.loadPlayers();
                JoeFC.data.loadDashboard();
            } catch (e) {
                console.error('Error saving player:', e);
                alert('Error saving player.');
            }
        },

        handleMatchSubmit: async (e) => {
            e.preventDefault();
            const id = document.getElementById('match-id').value;
            const date = document.getElementById('match-date').value;
            const time = document.getElementById('match-time').value;
            const homeTeam = document.getElementById('match-home').value.trim();
            const awayTeam = document.getElementById('match-away').value.trim();
            const location = document.getElementById('match-location').value.trim();
            const competition = document.getElementById('match-competition').value.trim();
            const status = document.getElementById('match-status').value;
            const description = document.getElementById('match-description').value.trim();
            const matchData = {
                date,
                time,
                homeTeam,
                awayTeam,
                location,
                competition,
                status,
                description: description || null,
                timestamp: Timestamp.now()
            };
            if (status === 'Finished') {
                matchData.result = {
                    homeScore: parseInt(document.getElementById('match-home-score').value) || 0,
                    awayScore: parseInt(document.getElementById('match-away-score').value) || 0
                };
            }
            try {
                if (id) {
                    await updateDoc(doc(JoeFC.firebase.db, 'matches', id), matchData);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-calendar-check',
                        color: 'bg-blue-500',
                        text: `Match updated: ${homeTeam} vs ${awayTeam}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Match updated successfully!');
                } else {
                    await addDoc(collection(JoeFC.firebase.db, 'matches'), matchData);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-calendar-plus',
                        color: 'bg-green-500',
                        text: `Match added: ${homeTeam} vs ${awayTeam}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Match added successfully!');
                }
                JoeFC.ui.closeModal('match-modal');
                JoeFC.data.loadMatches();
                JoeFC.data.loadDashboard();
            } catch (e) {
                console.error('Error saving match:', e);
                alert('Error saving match.');
            }
        },

        handleNewsSubmit: async (e) => {
            e.preventDefault();
            const id = document.getElementById('news-id').value;
            const title = document.getElementById('news-title').value.trim();
            const category = document.getElementById('news-category').value;
            const date = document.getElementById('news-date').value;
            const content = document.getElementById('news-content').value.trim();
            const file = document.getElementById('news-image').files[0];
            try {
                let imageUrl = document.getElementById('news-image-preview').src;
                if (file) {
                    imageUrl = await JoeFC.image.uploadImage(file, `news/${Date.now()}_${file.name}`);
                }
                const newsData = {
                    title,
                    category,
                    date,
                    content,
                    image: imageUrl,
                    timestamp: Timestamp.now()
                };
                if (id) {
                    await updateDoc(doc(JoeFC.firebase.db, 'news', id), newsData);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-newspaper',
                        color: 'bg-blue-500',
                        text: `News article updated: ${title}`,
                        timestamp: Timestamp.now()
                    });
                    alert('News article updated successfully!');
                } else {
                    await addDoc(collection(JoeFC.firebase.db, 'news'), newsData);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-newspaper',
                        color: 'bg-purple-500',
                        text: `News article published: ${title}`,
                        timestamp: Timestamp.now()
                    });
                    alert('News article published successfully!');
                }
                JoeFC.ui.closeModal('news-modal');
                JoeFC.data.loadNews();
                JoeFC.data.loadDashboard();
            } catch (e) {
                console.error('Error saving news:', e);
                alert('Error saving news article.');
            }
        },

        handleCoachSubmit: async (e) => {
            e.preventDefault();
            const name = document.getElementById('coach-name').value.trim();
            const speech = document.getElementById('coach-speech').value.trim();
            const badges = Array.from(document.getElementById('badges-container').children).map(badge => badge.textContent.replace('×', '').trim());
            const file = document.getElementById('coach-image').files[0];
            try {
                let imageUrl = document.getElementById('coach-image-preview').src;
                if (file) {
                    imageUrl = await JoeFC.image.uploadImage(file, `coach/coach_${Date.now()}_${file.name}`);
                }
                const coachData = {
                    name,
                    speech,
                    badges,
                    image: imageUrl,
                    timestamp: Timestamp.now()
                };
                await updateDoc(doc(JoeFC.firebase.db, 'settings', 'coach'), coachData);
                await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                    icon: 'fa-user-tie',
                    color: 'bg-blue-500',
                    text: `Coach information updated: ${name}`,
                    timestamp: Timestamp.now()
                });
                alert('Coach information saved successfully!');
                JoeFC.data.loadCoach();
            } catch (e) {
                console.error('Error saving coach:', e);
                alert('Error saving coach information.');
            }
        },

        handleSponsorSubmit: async (e) => {
            e.preventDefault();
            const id = document.getElementById('sponsor-id').value;
            const name = document.getElementById('sponsor-name').value.trim();
            const type = document.getElementById('sponsor-type').value;
            const website = document.getElementById('sponsor-website').value.trim();
            const file = document.getElementById('sponsor-logo').files[0];
            try {
                let imageUrl = document.getElementById('sponsor-logo-preview').src;
                if (file) {
                    imageUrl = await JoeFC.image.uploadImage(file, `sponsors/${Date.now()}_${file.name}`);
                }
                const sponsorData = {
                    name,
                    type,
                    website: website || null,
                    image: imageUrl,
                    timestamp: Timestamp.now()
                };
                if (id) {
                    await updateDoc(doc(JoeFC.firebase.db, 'sponsors', id), sponsorData);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-handshake',
                        color: 'bg-blue-500',
                        text: `Sponsor updated: ${name}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Sponsor updated successfully!');
                } else {
                    await addDoc(collection(JoeFC.firebase.db, 'sponsors'), sponsorData);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-handshake',
                        color: 'bg-red-500',
                        text: `Sponsor added: ${name}`,
                        timestamp: Timestamp.now()
                    });
                    alert('Sponsor added successfully!');
                }
                JoeFC.ui.closeModal('sponsor-modal');
                JoeFC.data.loadSponsors();
                JoeFC.data.loadDashboard();
            } catch (e) {
                console.error('Error saving sponsor:', e);
                alert('Error saving sponsor.');
            }
        },

        handleSettingsSubmit: async (e) => {
            e.preventDefault();
            try {
                const nextMatchData = {
                    homeTeam: document.getElementById('next-match-home').value.trim(),
                    awayTeam: document.getElementById('next-match-away').value.trim(),
                    date: document.getElementById('next-match-date').value,
                    time: document.getElementById('next-match-time').value,
                    competition: document.getElementById('next-match-competition').value.trim(),
                    timestamp: Timestamp.now()
                };
                const statsData = {
                    matches: parseInt(document.getElementById('stats-matches').value) || 0,
                    wins: parseInt(document.getElementById('stats-wins').value) || 0,
                    goals: parseInt(document.getElementById('stats-goals').value) || 0,
                    points: parseInt(document.getElementById('stats-points').value) || 0,
                    timestamp: Timestamp.now()
                };
                const footerData = {
                    text: document.getElementById('footer-text').value.trim(),
                    timestamp: Timestamp.now()
                };
                const socialData = {
                    facebook: document.getElementById('social-facebook').value.trim() || null,
                    twitter: document.getElementById('social-twitter').value.trim() || null,
                    instagram: document.getElementById('social-instagram').value.trim() || null,
                    youtube: document.getElementById('social-youtube').value.trim() || null,
                    tiktok: document.getElementById('social-tiktok').value.trim() || null,
                    timestamp: Timestamp.now()
                };
                await Promise.all([
                    updateDoc(doc(JoeFC.firebase.db, 'settings', 'nextMatch'), nextMatchData),
                    updateDoc(doc(JoeFC.firebase.db, 'settings', 'stats'), statsData),
                    updateDoc(doc(JoeFC.firebase.db, 'settings', 'footer'), footerData),
                    updateDoc(doc(JoeFC.firebase.db, 'settings', 'social'), socialData)
                ]);
                await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                    icon: 'fa-cog',
                    color: 'bg-blue-500',
                    text: 'Club settings updated',
                    timestamp: Timestamp.now()
                });
                alert('Settings saved successfully!');
                JoeFC.data.loadSettings();
            } catch (e) {
                console.error('Error saving settings:', e);
                alert('Error saving settings.');
            }
        }
    };

    // Authentication functions
    JoeFC.auth = {
        logout: () => {
            JoeFC.ui.showConfirmModal('Are you sure you want to logout?', async () => {
                try {
                    await signOut(JoeFC.firebase.auth);
                    await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                        icon: 'fa-sign-out-alt',
                        color: 'bg-gray-500',
                        text: 'User logged out',
                        timestamp: Timestamp.now()
                    });
                    alert('You have been logged out successfully!');
                    window.location.href = 'logout.html';
                } catch (e) {
                    console.error('Error logging out:', e);
                    alert('Error logging out.');
                }
            });
        }
    };

    // Gallery drag and drop functions
    JoeFC.gallery = {
        handleDrop: (e) => {
            e.preventDefault();
            e.stopPropagation();
            const dt = e.dataTransfer;
            const files = e.dataTransfer.files;
            JoeFC.gallery.handleFiles(files);
        },

        handleFiles: (files) => {
            const uploadedImages = document.getElementById('uploaded-images');
            uploadedImages.innerHTML = '';
            if (files.length > 0) {
                document.getElementById('upload-progress').classList.remove('hidden');
                document.getElementById('upload-count').textContent = `0}/${files.length}`;
                document.getElementById('upload-progress-bar').style.width = '0%';
                document.getElementById('save-button-container').classList.remove('hidden');
                Array.from(files).forEach((file, index) => {
                    if (file.type.match('image.*')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imgContainer = doc.createElement('div');
                            imgContainer.className = 'relative group';
                            imgContainer.innerHTML = `
                                <img src="${e.target.result}" class="w-full h-48 object-cover rounded-lg">
                                <button class="remove-img-btn absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white p-2 rounded-full opacity-0 group-hover:opacity-100">
                                    <button class="remove-img-btn mr-2 text-white p-2 rounded-full">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                `;
                            </div>`;
                            uploadedImages.appendChild(imgContainer);
                            const uploadedCount = uploadedImages.children.length;
                            document.getElementById('upload-count').textContent = `${uploadedCount}/${files.length}`;
                            const progress = (uploadedCount / files.length) * 100;
                            document.getElementById('upload-progress-bar').style.width = `${progress}%`;
                            if (uploadedCount === files.length) {
                                document.getElementById('upload-progress').classList.add('hidden');
                            }
                        };
                    });
                    reader.readAsDataURL(file);
                });
            }
        },

        saveGalleryImages: async () => {
            try {
                const uploadedImages = await getDoc.getElementById('uploaded-images').children;
                const files = Array.from(document.getElementById('gallery-upload').files);
                for (let i = 0; i < files.length; i++) {
                    if (files[i].type.match('image.*')) {
                        const imageUrl = await JoeFC.image.uploadImage(files[i], `gallery/${Date.now()}_${files[i].name}`);
                        await addDoc(collection(JoeFC.firebase.db, 'gallery'), {
                            image: imageUrl,
                            description: `Image uploaded on ${new Date().toLocaleDateString()}`,
                            timestamp: Timestamp.now()
                        });
                    }
                }
                await addDoc(collection(JoeFC.firebase.db, 'activities'), {
                    icon: 'fa-image',
                    color: 'bg-yellow-500',
                    text: `${files.length} new images added to gallery`,
                    timestamp: Timestamp.now()
                });
                alert('Gallery images saved successfully!');
                document.getElementById('uploaded-images').innerHTML = '';
                document.getElementById('save-button-container').classList.add('hidden');
                document.getElementById('gallery-upload').value = '';
                JoeFC.data.loadGallery();
                JoeFC.data.loadDashboard();
            } catch (e) {
                console.error('Error saving gallery images:', e);
                alert('Error saving gallery images.');
                try {
            }
        }
    };

    // Event listener setup
    function initialize() {
        // Sidebar toggle
        document.getElementById('toggle-sidebar').addEventListener('click', JoeFC.ui.toggleSidebar);

        // Sidebar tab navigation
        document.getElementById('sidebar-nav').addEventListener('click', (e) => {
            const button = e.target.closest('.tab-button');
            if (button) {
                e.preventDefault();
                JoeFC.ui.showTab(button.dataset.tab);
            }
        });

        // Modal close buttons
        document.addEventListener('click', (e) => {
            const closeBtn = e.target.closest('button.close-modal-btn');
            if (closeBtn) {
                JoeFC.ui.closeModal(closeBtn.dataset.modal);
            }
        });

        // Form submissions
        document.getElementById('player-form').addEventListener('submit', JoeFC.forms.handlePlayerSubmit);
        document.getElementById('match-form').addEventListener('submit', JoeFC.forms.handleMatchSubmit);
        document.getElementById('news-form').addEventListener('submit', JoeFC.forms.handleNewsSubmit);
        document.getElementById('coach-form').addEventListener('submit', JoeFC.forms.handleCoachSubmit);
        document.getElementById('sponsor-form').addEventListener('submit', JoeFC.forms.handleSponsorSubmit);
        document.getElementById('settings-form').setEventListener('submit', JoeFC.forms.handleSettingsSubmit);

        // Image inputs
        document.getElementById('player-image').addEventListener('change', JoeFC.image.previewPlayerImage);
        document.getElementById('coach-image').addEventListener('change', JoeFC.image.previewCoachImage);
        document.getElementById('news-image').addEventListener('change', JoeFC.image.previewNewsImage);
        document.getElementById('sponsor-logo').addEventListener('change', JoeFC.image.previewSponsorImage);

        // Match status change
        document.getElementById('match-status').addEventListener('change', () => {
            document.getElementById('result-fields').classList.toggle('hidden', this.value !== 'Finished');
        });

        // Badge management
        document.addEventListener('click', (e) => {
            const removeBadgeBtn = e.target.closest('.remove-badge-btn');
            if (removeBadgeBtn) {
                removeBadgeBtn.parentElement.remove();
            }
        });

        document.getElementById('add-badge-btn').addEventListener('click', JoeFC.ui.addBadge);

        // Dynamic table and gallery actions
        document.addEventListener('click', (e) => {
            const editPlayerBtn = e.target.closest('.edit-player-btn');
            const deletePlayerBtn = e.target.closest('.delete-player-btn');
            const editMatchBtn = e.target.closest('.edit-match-btn');
            const deleteMatchBtn = e.target.closest('.delete-match-btn');
            const editNewsBtn = e.target.closest('.edit-news-btn');
            const deleteNewsBtn = e.target.closest('.delete-news-btn');
            const deleteGalleryBtn = e.target.closest('.delete-gallery-btn');
            const editSponsorBtn = e.target.closest('.edit-sponsor-btn');
            const deleteSponsorBtn = e.target.closestdelete-sponsor-btn');

            if (editPlayerBtn) {
                JoeFC.ui.openPlayerModal(editPlayerBtn.dataset.id);
            } else if (deletePlayerBtn) {
                JoeFC.data.deletePlayer(deletePlayerBtn.dataset.id, deletePlayerBtn.dataset.name);
            } else if (editMatchBtn) {
                JoeFC.ui.openMatchModal(editMatchBtn.dataset.id);
            } else if (deleteMatchBtn) {
                JoeFC.data.deleteMatch(deleteMatchBtn.dataset.id, deleteMatchBtn.dataset.name);
            } else if (editNewsBtn) {
                JoeFC.ui.openNewsModal(editNewsBtn.dataset.id);
            } else if (deleteNewsBtn) {
                JoeFC.data.deleteNews(deleteNewsBtn.dataset.id, deleteNewsBtn.dataset.title);
            } else if (deleteGalleryBtn) {
                JoeFC.data.deleteGalleryImage(deleteGalleryBtn.dataset.id, deleteGalleryBtn.dataset.description);
            } else if (editSponsorBtn) {
                JoeFC.ui.openSponsorModal(editSponsorBtn.dataset.id);
            } else if (deleteSponsorBtn) {
                JoeFC.data.deleteSponsor(deleteSponsorBtn.dataset.id, deleteSponsorBtn.dataset.name);
            }
        });

        // Add player, match, and gallery buttons
        document.addEventListener('click', (e) => {
            const addPlayerBtn = e.target.closest('.add-player-btn');
            const addMatchBtn = e.target.closest('.add-match-btn');
            const addNewsBtn = e.target.closest('.add-news-btn');
            const addSponsorBtn = e.target.closest('.add-sponsor-btn');
            const saveGalleryBtn = e.target.closest('.save-gallery-btn');

            if (addPlayerBtn) {
                JoeFC.ui.openPlayerModal();
            } else if (addMatchBtn) {
                JoeFC.ui.openMatchModal();
            } else if (addNewsBtn) {
                JoeFC.ui.openNewsModal();
            } else if (addSponsorBtn) {
                JoeFC.ui.openSponsorModal();
            } else if (saveGalleryBtn) {
                JoeFC.gallery.saveGalleryImages();
            }
        });

        // Drag and drop for gallery
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('gallery-upload');

        dropzone.addEventListener('click', () => fileInput.click());

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropzone.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropzone.addEventListener(eventName, () => dropzone.classList.add('active'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropzone.addEventListener(eventName, () => dropzone.classList.remove('active'), false);
        });

        dropzone.addEventListener('drop', JoeFC.gallery.handleDrop, false);

        fileInput.addEventListener('change', e => JoeFC.gallery.handleFiles(e.target.files), false);

        // Logout button
        document.getElementById('logout-btn').addEventListener('click', e => {
            e.preventDefault();
            JoeFC.auth.logout();
        });

        // Initial load
        JoeFC.data.loadDashboard();
    }

    // Run initialization
    document.addEventListener('DOMContentLoaded', initialize);
</script>

<script>
    // Inline script for HTML compatibility with event handlers
    function showTab(tabId) {
        JoeFC.ui.showTab(tabId);
    }
    function openPlayerModal(id) {
        JoeFC.ui.openPlayerModal(id);
    }
    function openMatchModal(id) {
        JoeFC.ui.openMatchModal(id);
    }
    function openNewsModal(id) {
        JoeFC.ui.openNewsModal(id);
    }
    function openSponsorModal(id) {
        JoeFC.ui.openSponsorModal(id);
    }
    function deletePlayer(id, name) {
        JoeFC.data.deletePlayer(id, name);
    }
    function deleteMatch(id, name) {
        JoeFC.data.deleteMatch(id, name);
    }
    function deleteNews(id, title) {
        JoeFC.data.deleteNews(id, title);
    }
    function deleteGalleryImage(id, description) {
        JoeFC.data.deleteGalleryImage(id, description);
    }
    function deleteSponsor(id, name) {
        JoeFC.data.deleteSponsor(id, name);
    }
</script>
    
</body>
</html>
